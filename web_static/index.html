<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
    <title>Weather App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            background-color: #f0f0f0;
            padding: 2rem;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            color: #3f3f3f;
        }

        #weather-data {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        #weather-data p {
            font-size: 1.2rem;
            flex-basis: calc(33% - 1rem);
        }

        #weather-data img {
            width: 50px; /* Adjust the size of the weather icon as needed */
            height: auto;
        }

        #map {
            height: 400px; /* Adjust the height of the map as needed */
            width: 100%;
            margin-bottom: 1.5rem;
        }

        #city-form {
            margin-bottom: 1.5rem;
        }
    </style>
</head>
<body>
    <h1>Weather App</h1>
    <form id="city-form">
        <label for="city-input">Enter City Name:</label>
        <input type="text" id="city-input" name="city" required>
        <button type="submit">Get Weather</button>
    </form>
    <div id="weather-data"></div>
    <div id="map"></div>
    <script>
        let map;

        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 0, lng: 0 }, // Initial center of the map (lat: 0, lng: 0 represents the world map)
                zoom: 2, // Initial zoom level of the map
            });
        }

        async function geocodeLocation(city) {
            try {
                const response = await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${city}&key=AIzaSyCErwLYF92V4GOXQQ1WJ-Zk1YOQsS_msog`);
                const data = await response.json();
                return data.results[0].geometry.location;
            } catch (error) {
                console.error('Error geocoding location:', error);
                return null;
            }
        }

        async function fetchWeatherData(city) {
            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=78d6507e36c0f4d824cb206fface4135&units=metric`);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching weather data:', error);
                return null;
            }
        }

        async function displayWeatherData(event) {
            event.preventDefault();
            const cityInput = document.getElementById('city-input');
            const cityName = cityInput.value.trim();

            if (cityName) {
                const weatherDataDiv = document.getElementById('weather-data');
                weatherDataDiv.innerHTML = ''; // Clear previous weather data

                try {
                    const location = await geocodeLocation(cityName);
                    if (location) {
                        map.setCenter(location);
                        map.setZoom(10); // Adjust the zoom level as needed

                        const data = await fetchWeatherData(cityName);
                        if (data) {
                            const temp = document.createElement('p');
                            temp.textContent = `Temperature: ${data.main.temp} Â°C`;
                            weatherDataDiv.appendChild(temp);

                            const humidity = document.createElement('p');
                            humidity.textContent = `Humidity: ${data.main.humidity}%`;
                            weatherDataDiv.appendChild(humidity);

                            const windSpeed = document.createElement('p');
                            windSpeed.textContent = `Wind Speed: ${data.wind.speed} m/s`;
                            weatherDataDiv.appendChild(windSpeed);
                        } else {
                            weatherDataDiv.textContent = 'Failed to fetch weather data.';
                        }
                    } else {
                        console.error('Failed to geocode location');
                    }
                } catch (error) {
                    console.error('Error displaying weather data:', error);
                }
            }
        }

        document.getElementById('city-form').addEventListener('submit', displayWeatherData);
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCErwLYF92V4GOXQQ1WJ-Zk1YOQsS_msog&callback=initMap"></script>
</body>
</html>
